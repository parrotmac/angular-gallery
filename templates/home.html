{% extends "base.html" %}
{% load staticfiles %}
{% block page_name %}Home{% endblock %}
{% block head_area %}
    <link href="{% static "responsive-carousel.css" %}" rel="stylesheet">
    <link href="{% static "responsive-percent-based-features.css" %}" rel="stylesheet">
{% endblock %}
{% block page_option_info %}{% endblock %}
{% block page_option_add_to_lightbox %}{% endblock %}
{% block page_option_extra_item %}{% endblock %}
{% block page_content %}
            <div class="feature-area">
                <a class="feature-link primary-feature-link" href="{% url 'view_gallery' primary_target_gallery %}">
                    <img src="/media/{{ primary_feature_img }}" class="pretty-image img-responsive">
                    <span class="feature-hover-text"><span style="font-size: 20pt">{{ primary_feature_heading }}</span><br> {{ primary_feature_subheading }}</span>
                </a>
                <a class="feature-link secondary-feature-link" href="{% url 'view_gallery' secondary_target_gallery %}">
                    <img src="/media/{{ secondary_feature_img }}" class="pretty-image img-responsive">
                    <span class="feature-hover-text"><span style="font-size: 20pt">{{ secondary_feature_heading }}</span><br> {{ secondary_feature_subheading }}</span>
                </a>
                <div class="clear-fix"></div>
            </div>
            <div class="responsive-carousel">
                    <div class="rc-arrow-absolute">
{#                        <!-- We should consider making this next span a button... -->#}
                        <span class="rc-arrow-container rc-arrow-container-left" onclick="responsiveCarouselArrow('right')">
                            <span class="rc-arrow">&lt;</span>
                        </span>
                    </div>
                    <div class="rc-mask">
                        <div class="rc-container">
                            <div class="rc-item-collection">
                                {% for gallery_thumb in thumbnail_galleries %}
                                <a href="{% url "view_gallery" gallery_thumb.id %}" class="rc-item">
                                    <img class="pretty-image rc-thumbnail" src="{{ gallery_thumb.cover_photo.preview.url }}">
                                    <span class="rc-item-info">{{ gallery_thumb.name }}</span>
                                </a>
                                {% endfor %}
{#                            These are just for testing :)               #}
{#                                <a href="#" class="rc-item">#}
{#                                    <img class="pretty-image" src="http://dummyimage.com/300x200/DDD/222.png&text=Carousel Image">#}
{#                                    <span class="rc-item-info">First Carousel Image</span>#}
{#                                </a>#}
{#                                <a href="#" class="rc-item">#}
{#                                    <img class="pretty-image" src="http://dummyimage.com/300x200/222/DDD.png&text=Carousel Image">#}
{#                                    <span class="rc-item-info">Second Carousel Image</span>#}
{#                                </a>#}
{#                                <a href="#" class="rc-item">#}
{##}
{#                                    <img class="pretty-image" src="http://dummyimage.com/300x200/DDD/222.png&text=Carousel Image">#}
{#                                    <span class="rc-item-info">Third Carousel Image</span>#}
{#                                </a>#}
{#                                <a href="#" class="rc-item">#}
{##}
{#                                    <img class="pretty-image" src="http://dummyimage.com/300x200/222/DDD.png&text=Carousel Image">#}
{#                                    <span class="rc-item-info">Fourth Carousel Image</span>#}
{#                                </a>#}
{#                                <a href="#" class="rc-item">#}
{##}
{#                                    <img class="pretty-image" src="http://dummyimage.com/300x200/DDD/222.png&text=Carousel Image">#}
{#                                    <span class="rc-item-info">Fifth Carousel Image</span>#}
{#                                </a>#}
                            </div>
                        </div>
                    </div>
                    <div class="rc-arrow-absolute">
                        <span class="rc-arrow-container rc-arrow-container-right" onclick="responsiveCarouselArrow('left')">
                            <span class="rc-arrow">&gt;</span>
                        </span>
                    </div>
                </div>
{% endblock %}
{% block put_scripts_here %}
    <script>
    var incrementAmount = 300;
    var animationSpeed = 200;
    function responsiveCarouselArrow(direction) {
        var carouselContentWidth = 0;
        var numberOfCarouselItems = $(".rc-item-collection a").length;
        for(var i = 0; i < numberOfCarouselItems; i++) {
            carouselContentWidth += $(".rc-item-collection a")[i].clientWidth;
        }
        var currentOffset = parseInt($($(".rc-container")[0]).css("left"));
        var viewWidth = $($(".rc-mask")).width();
        incrementAmount = viewWidth*0.6;
        var overhang = carouselContentWidth - (Math.abs(currentOffset) + viewWidth);
        if(direction == 'left') {
{#            var newLeft = #}
            $($(".rc-container")[0]).animate({left: -(Math.abs(currentOffset) + (incrementAmount - Math.abs(Math.min(0, overhang - incrementAmount))))}, animationSpeed);
{#            //Time to move <-- that way#}
        } else if(direction == 'right') {
{#            //Time to move --> this way#}
            $($(".rc-container")[0]).animate({left: -(Math.max(0, Math.abs(currentOffset)-incrementAmount))}, animationSpeed);
        } else {
            console.error("You are broken");
        }
    }



    // Touch-friendly carousel script
    var previousTouchLocation = 0;
    var currentTouchCount = 0;
    var pendingEvent;

    function handleStart(evt) {
        console.log(evt);
        pendingEvent = evt;
        evt.preventDefault();
        previousTouchLocation = evt.changedTouches[0].clientX;
    }

    function handleMove(evt) {
        evt.preventDefault();
        var carouselInner = $($(".rc-container")[0]);
        var carouselOuter = $($(".rc-mask")[0]);
        var maxLeft = carouselInner[0].clientWidth - carouselOuter[0].clientWidth;

        var currentLeft = carouselInner.position().left;

        var thisTouchChange = evt.changedTouches[0].clientX;

        var rightBound = Math.min(0, currentLeft + (thisTouchChange - previousTouchLocation));

        var newLeft =  Math.min(maxLeft, Math.abs(rightBound));

        carouselInner.css("left", -newLeft);
        previousTouchLocation = thisTouchChange;
        currentTouchCount++;
        console.log("touch count:" + currentTouchCount);
    }

    function handleEnd(evt) {
        console.log("touch count:" + currentTouchCount);
        if(currentTouchCount < 2) {
{#            //Hacks hacks hacks hacks hacks  #}
            document.location = pendingEvent.srcElement.offsetParent.href;
        }
        currentTouchCount = 0;
    }

    var carouselSlider = document.getElementsByClassName('rc-container')[0];
    carouselSlider.addEventListener("touchmove", handleMove, false);
    carouselSlider.addEventListener("touchstart", handleStart, false);
    carouselSlider.addEventListener("touchend", handleEnd, false);
    carouselSlider.addEventListener("touchcancel", handleEnd, false);
    carouselSlider.addEventListener("touchleave", handleEnd, false);

    $(".rc-item-info")[1].opacity = 1;


{#    //Need a function that makes sure expanding the window after scrolling to the end doesn't break the layout#}
    </script>

{% endblock %}
r